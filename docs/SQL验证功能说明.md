# SQL验证功能说明

## 功能概述

SQL验证功能是AI SQL提示词生成工具的重要补充，允许用户验证AI生成的SQL语句的正确性、安全性和性能。该功能提供了完整的SQL验证流程，包括语法检查、安全检查、执行计划分析和样本结果预览。

## 主要特性

### 1. 多数据库支持
- **PostgreSQL**: 完整的语法检查、执行计划分析
- **MySQL**: 语法验证、性能分析
- **SQLite**: 轻量级数据库支持
- **SQL Server**: 企业级数据库支持

### 2. 安全机制
- **只读模式**: 默认启用，防止意外修改数据
- **危险操作检测**: 自动识别DROP、DELETE、UPDATE等危险操作
- **权限控制**: 支持最小权限原则
- **超时控制**: 防止长时间运行的查询

### 3. 验证功能
- **语法检查**: 验证SQL语句的语法正确性
- **执行计划**: 分析查询的执行计划和性能
- **样本执行**: 在安全环境下执行SQL并返回样本结果
- **元数据分析**: 分析查询影响的表和复杂度

## 使用流程

### 1. 配置数据库连接
1. 选择数据库类型（PostgreSQL、MySQL、SQLite、SQL Server）
2. 输入连接信息：
   - 主机地址（默认localhost）
   - 端口号
   - 数据库名称
   - 用户名和密码
   - SSL选项
3. 点击"测试连接"验证连接

### 2. 设置验证选项
- **只读模式**: 确保只执行SELECT查询
- **生成执行计划**: 分析查询性能
- **超时时间**: 设置查询超时（1-300秒）
- **最大行数**: 限制返回的样本数据行数（1-10000行）

### 3. 输入SQL语句
在SQL编辑器中输入要验证的SQL语句，支持：
- 语法高亮
- 多行编辑
- 自动格式化

### 4. 执行验证
点击"验证SQL"按钮，系统将：
1. 进行安全检查
2. 验证语法
3. 生成执行计划（如果启用）
4. 执行样本查询
5. 分析元数据

### 5. 查看结果
验证结果包含：
- **概览统计**: 语法检查状态、安全检查状态、执行时间
- **详细报告**: 可展开查看具体信息
  - 语法错误详情
  - 安全警告和阻止的操作
  - 执行计划详情
  - 样本数据表格
  - 元数据信息（影响的表、复杂度等）

## 安全特性

### 1. 操作限制
系统会自动检测并阻止以下危险操作：
- DDL操作：DROP、CREATE、ALTER、TRUNCATE
- DML操作：DELETE、UPDATE、INSERT
- 系统操作：GRANT、REVOKE、EXEC
- 文件操作：LOAD DATA、INTO OUTFILE

### 2. 只读模式
- 默认启用只读模式
- 只允许SELECT查询
- 自动添加LIMIT限制
- 防止数据修改

### 3. 超时控制
- 默认30秒超时
- 可配置1-300秒
- 防止长时间运行的查询
- 自动清理连接

## 技术实现

### 后端架构
- **连接管理**: 支持多种数据库的连接池管理
- **安全模块**: 实现SQL安全检查和操作限制
- **执行器**: 统一的SQL执行接口
- **验证引擎**: 集成语法检查、执行计划、样本执行

### 前端界面
- **标签页设计**: 分离提示词生成和SQL验证功能
- **响应式布局**: 适配不同屏幕尺寸
- **实时反馈**: 提供加载状态和错误提示
- **结果展示**: 丰富的验证结果展示组件

### API接口
- `POST /api/sql/validate`: 执行SQL验证
- `POST /api/sql/test-connection`: 测试数据库连接
- `GET /api/sql/dialects`: 获取支持的数据库类型

## 使用场景

### 1. AI生成的SQL验证
- 验证AI生成的SQL语句的正确性
- 检查语法和逻辑错误
- 评估查询性能

### 2. 学习辅助
- 理解SQL执行计划
- 学习查询优化技巧
- 掌握不同数据库的语法差异

### 3. 开发调试
- 快速验证SQL语句
- 测试数据库连接
- 调试查询问题

### 4. 安全审计
- 检查SQL的安全性
- 识别潜在的安全风险
- 确保只读操作

## 最佳实践

### 1. 连接配置
- 使用只读数据库用户
- 启用SSL连接
- 设置合理的超时时间

### 2. 验证选项
- 始终启用只读模式
- 根据数据量调整最大行数
- 启用执行计划分析

### 3. 安全考虑
- 定期检查安全警告
- 避免在生产环境使用
- 保护数据库连接信息

## 故障排除

### 1. 连接问题
- 检查网络连接
- 验证数据库配置
- 确认用户权限

### 2. 验证失败
- 检查SQL语法
- 确认表名和字段名
- 查看错误详情

### 3. 性能问题
- 调整超时设置
- 减少最大行数
- 优化SQL语句

## 未来规划

### 1. 功能增强
- 支持更多数据库类型
- 添加查询优化建议
- 实现SQL格式化功能

### 2. 性能优化
- 连接池优化
- 缓存机制
- 异步处理

### 3. 用户体验
- 历史记录功能
- 批量验证
- 导出功能

## 总结

SQL验证功能为AI SQL提示词生成工具提供了重要的质量保证机制，通过全面的验证流程和安全控制，确保生成的SQL语句既正确又安全。该功能不仅提高了工具的可信度，也为用户提供了学习和调试的便利。